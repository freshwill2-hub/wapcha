<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL ê´€ë¦¬ - Copychu Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body { background-color: #0f172a; }
        .card { background-color: #1e293b; border-radius: 12px; }
        .input-field { 
            background-color: #334155; 
            border: 1px solid #475569;
            color: white;
        }
        .input-field:focus {
            border-color: #22d3ee;
            outline: none;
        }
        .input-field:disabled {
            background-color: #1e293b;
            color: #64748b;
            cursor: not-allowed;
        }
        .btn-primary {
            background: linear-gradient(135deg, #22d3ee, #0ea5e9);
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #06b6d4, #0284c7);
            transform: translateY(-1px);
        }
        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
        }
        .btn-success:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-1px);
        }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        /* âœ… ê°•ì œ ì¢…ë£Œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-force-kill {
            background: linear-gradient(135deg, #7f1d1d, #450a0a);
            border: 2px solid #dc2626;
            animation: pulse-danger 2s infinite;
        }
        .btn-force-kill:hover {
            background: linear-gradient(135deg, #991b1b, #7f1d1d);
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.5);
        }
        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 5px rgba(220, 38, 38, 0.3); }
            50% { box-shadow: 0 0 15px rgba(220, 38, 38, 0.6); }
        }
        .status-pending { color: #fbbf24; }
        .status-processing { color: #22d3ee; }
        .status-completed { color: #22c55e; }
        .status-error { color: #ef4444; }
        .log-time { color: #64748b; font-size: 0.75rem; min-width: 70px; }
        .log-info { color: #94a3b8; }
        .log-success { color: #22c55e; }
        .log-error { color: #ef4444; }
        .log-warning { color: #fbbf24; }
        .checkbox-custom {
            width: 18px;
            height: 18px;
            accent-color: #22d3ee;
        }
        /* ì‚¬ì´ë“œë°” í™œì„± ìƒíƒœ */
        .nav-active {
            background-color: #1e293b;
            color: #22d3ee !important;
            border-left: 3px solid #22d3ee;
        }
        /* ì§„í–‰ ìƒíƒœ í‘œì‹œ */
        .progress-bar {
            height: 8px;
            background: #334155;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #06b6d4);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        /* ìƒíƒœ ë°°ì§€ */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-badge.idle { background: #334155; color: #94a3b8; }
        .status-badge.running { background: rgba(34, 211, 238, 0.15); color: #22d3ee; }
        .status-badge.error { background: rgba(239, 68, 68, 0.15); color: #ef4444; }
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }
        .status-badge.running .status-dot {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
    </style>
</head>
<body class="text-gray-100 min-h-screen">
    <!-- ì‚¬ì´ë“œë°” -->
    <div class="fixed left-0 top-0 h-full w-56 bg-slate-900 border-r border-slate-700">
        <div class="p-5 border-b border-slate-700">
            <h1 class="text-xl font-bold text-cyan-400">COPYCHU</h1>
            <p class="text-xs text-gray-500 mt-1">Automation Dashboard</p>
        </div>
        
        <nav class="p-3 space-y-1">
            <!-- âœ… index.htmlì˜ í•´ë‹¹ ì„¹ì…˜ìœ¼ë¡œ ì—°ê²° -->
            <a href="/" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
            </a>
            <a href="/#pipeline" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>â–¶ï¸</span> íŒŒì´í”„ë¼ì¸
            </a>
            <a href="/urls.html" class="flex items-center gap-3 px-4 py-3 rounded-lg nav-active">
                <span>ğŸ”—</span> URL ê´€ë¦¬
            </a>
            <a href="/#monitor" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>ğŸ“º</span> ëª¨ë‹ˆí„°ë§
            </a>
            <a href="/logs.html" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>ğŸ“œ</span> ë¡œê·¸ ë·°ì–´
            </a>
            <a href="/#gallery" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>ğŸ–¼ï¸</span> ê°¤ëŸ¬ë¦¬
            </a>
            <a href="/#settings" class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-400 hover:bg-slate-800 hover:text-white transition-colors">
                <span>âš™ï¸</span> ì„¤ì •
            </a>
        </nav>
        
        <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-slate-700">
            <div class="status-badge idle" id="status-badge">
                <div class="status-dot"></div>
                <span id="status-text">ëŒ€ê¸°ì¤‘</span>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  -->
    <div class="ml-56 p-8">
        <!-- í—¤ë” -->
        <div class="mb-8">
            <h2 class="text-2xl font-bold">URL ê´€ë¦¬</h2>
            <p class="text-gray-400 mt-1">ì¹´í…Œê³ ë¦¬ URLì—ì„œ ì œí’ˆì„ ìˆ˜ì§‘í•˜ê³  ìë™ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤</p>
        </div>

        <!-- âœ… ì§„í–‰ ìƒí™© í‘œì‹œ (ìƒˆë¡œ ì¶”ê°€) -->
        <div id="progress-section" class="card p-6 mb-6 hidden">
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-semibold text-cyan-400">ğŸ”„ ì²˜ë¦¬ ì§„í–‰ ì¤‘</h3>
                <span id="progress-phase" class="text-sm text-gray-400">Phase 0</span>
            </div>
            <div class="progress-bar mb-2">
                <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
            </div>
            <div class="flex justify-between text-sm text-gray-400">
                <span id="progress-current">0ê°œ ì²˜ë¦¬ë¨</span>
                <span id="progress-percent">0%</span>
            </div>
        </div>

        <!-- íƒ­ -->
        <div class="flex gap-2 mb-6 flex-wrap">
            <button id="tab-category" class="px-5 py-2.5 rounded-lg bg-cyan-500 text-white font-medium transition-all" onclick="showTab('category')">
                ğŸ“‚ ì¹´í…Œê³ ë¦¬ í
            </button>
            <button id="tab-product" class="px-5 py-2.5 rounded-lg bg-slate-700 text-gray-300 hover:bg-slate-600 transition-all" onclick="showTab('product')">
                ğŸ“¦ ê°œë³„ URL ì¶”ê°€
            </button>
            <button id="tab-list" class="px-5 py-2.5 rounded-lg bg-slate-700 text-gray-300 hover:bg-slate-600 transition-all" onclick="showTab('list')">
                ğŸ“‹ ë“±ë¡ëœ ì œí’ˆ
            </button>
            <button id="tab-logs" class="px-5 py-2.5 rounded-lg bg-slate-700 text-gray-300 hover:bg-slate-600 transition-all" onclick="showTab('logs')">
                ğŸ“œ ì‹¤ì‹œê°„ ë¡œê·¸
            </button>
        </div>

        <!-- ===================== ì¹´í…Œê³ ë¦¬ í íƒ­ ===================== -->
        <div id="content-category" class="space-y-6">
            <!-- ì¹´í…Œê³ ë¦¬ URL ì¶”ê°€ -->
            <div class="card p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span class="text-2xl">ğŸ“‚</span> ì¹´í…Œê³ ë¦¬ URL ì¶”ê°€
                </h3>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ì˜¬ë¦¬ë¸Œì˜ ì¹´í…Œê³ ë¦¬ URL</label>
                        <input type="text" id="category-url" class="input-field w-full px-4 py-3 rounded-lg" 
                               placeholder="https://www.oliveyoung.co.kr/store/main/getBestList.do?dispCatNo=...">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ì¹´í…Œê³ ë¦¬ ì´ë¦„ (ì„ íƒ)</label>
                        <input type="text" id="category-name" class="input-field w-full px-4 py-3 rounded-lg" 
                               placeholder="ì˜ˆ: ìŠ¤í‚¨ì¼€ì–´, ì„ ì¼€ì–´">
                    </div>
                </div>
                
                <!-- ìˆ˜ì§‘ ì„¤ì • -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">ìµœëŒ€ ìˆ˜ì§‘ ê°œìˆ˜</label>
                        <input type="number" id="category-max" class="input-field w-full px-4 py-3 rounded-lg" 
                               value="100" min="1" max="1000">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">
                            <input type="checkbox" id="limit-pages-checkbox" class="checkbox-custom mr-2" onchange="togglePageLimit()">
                            í˜ì´ì§€ ìˆ˜ ì œí•œ
                        </label>
                        <div class="flex items-center gap-2">
                            <input type="number" id="category-max-pages" class="input-field w-full px-4 py-3 rounded-lg" 
                                   value="10" min="1" max="100" disabled>
                            <span id="pages-label" class="text-cyan-400 text-sm whitespace-nowrap font-medium">ë¬´ì œí•œ</span>
                        </div>
                    </div>
                    <div class="flex items-end">
                        <button onclick="addCategory()" class="btn-primary px-6 py-3 rounded-lg font-medium w-full text-slate-900">
                            â• íì— ì¶”ê°€
                        </button>
                    </div>
                </div>
                
                <p class="text-sm text-gray-500">
                    ğŸ’¡ ì²´í¬ í•´ì œ ì‹œ ë§ˆì§€ë§‰ í˜ì´ì§€ê¹Œì§€ ìë™ ìˆ˜ì§‘ | SKU ì¤‘ë³µ ì œí’ˆì€ ìë™ ìŠ¤í‚µë©ë‹ˆë‹¤
                </p>
            </div>

            <!-- ì¹´í…Œê³ ë¦¬ í ëª©ë¡ -->
            <div class="card p-6">
                <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                    <h3 class="text-lg font-semibold flex items-center gap-2">
                        <span class="text-2xl">ğŸ“‹</span> ì¹´í…Œê³ ë¦¬ í
                    </h3>
                    <div class="flex flex-wrap gap-2">
                        <!-- âœ… ë‘ ê°€ì§€ ì‹¤í–‰ ëª¨ë“œ ëª…í™•í•˜ê²Œ ë¶„ë¦¬ -->
                        <button onclick="processQueueUrlOnly()" id="btn-url-only" class="btn-primary px-4 py-2 rounded-lg text-sm font-medium text-slate-900">
                            ğŸ“¥ URLë§Œ ìˆ˜ì§‘
                        </button>
                        <button onclick="processQueueFull()" id="btn-full-pipeline" class="btn-success px-4 py-2 rounded-lg text-sm font-medium text-white">
                            ğŸš€ ì „ì²´ íŒŒì´í”„ë¼ì¸
                        </button>
                        <button onclick="stopQueue()" id="btn-stop" class="btn-danger px-4 py-2 rounded-lg text-sm font-medium text-white">
                            â¹ï¸ ì¤‘ì§€
                        </button>
                        <button onclick="forceKill()" id="btn-force-kill" class="btn-force-kill px-4 py-2 rounded-lg text-sm font-bold text-white">
                            ğŸ”´ ê°•ì œ ì¢…ë£Œ
                        </button>
                        <button onclick="clearCompleted()" class="px-4 py-2 rounded-lg text-sm bg-slate-700 hover:bg-slate-600 text-gray-300">
                            ğŸ—‘ï¸ ì™„ë£Œ í•­ëª© ì‚­ì œ
                        </button>
                    </div>
                </div>
                
                <!-- âœ… ì‹¤í–‰ ëª¨ë“œ ì„¤ëª… (Phase 5 ì¶”ê°€) -->
                <div class="bg-slate-800 rounded-lg p-4 mb-4 text-sm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="flex items-start gap-3">
                            <span class="text-cyan-400 text-lg">ğŸ“¥</span>
                            <div>
                                <p class="font-medium text-cyan-400">URLë§Œ ìˆ˜ì§‘</p>
                                <p class="text-gray-400">Phase 0ë§Œ ì‹¤í–‰ â†’ URLê³¼ SKUë§Œ ì €ì¥</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="text-green-400 text-lg">ğŸš€</span>
                            <div>
                                <p class="font-medium text-green-400">ì „ì²´ íŒŒì´í”„ë¼ì¸</p>
                                <p class="text-gray-400">Phase 0â†’1â†’2â†’3â†’4â†’5 ì‹¤í–‰</p>
                                <p class="text-gray-500 text-xs mt-1">ì™„ì „í•œ ì œí’ˆ ë°ì´í„° + Shopify ì—…ë¡œë“œ</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="category-queue" class="space-y-3">
                    <p class="text-gray-500 text-center py-8">ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>
                </div>
            </div>
        </div>

        <!-- ===================== ê°œë³„ URL ì¶”ê°€ íƒ­ ===================== -->
        <div id="content-product" class="hidden space-y-6">
            <div class="card p-6">
                <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span class="text-2xl">ğŸ“¦</span> ê°œë³„ ì œí’ˆ URL ì¶”ê°€
                </h3>
                
                <div class="flex gap-4 mb-4">
                    <input type="text" id="product-url" class="input-field flex-1 px-4 py-3 rounded-lg" 
                           placeholder="https://www.oliveyoung.co.kr/store/goods/getGoodsDetail.do?goodsNo=...">
                    <button onclick="addProductUrl()" class="btn-primary px-6 py-3 rounded-lg font-medium text-slate-900">
                        â• ì¶”ê°€
                    </button>
                </div>
                
                <p class="text-sm text-gray-500 mb-6">
                    ğŸ’¡ ì˜¬ë¦¬ë¸Œì˜ ì œí’ˆ ìƒì„¸ í˜ì´ì§€ URLì„ ì…ë ¥í•˜ì„¸ìš” (SKU ì¤‘ë³µ ì‹œ ìë™ ìŠ¤í‚µ)
                </p>
                
                <!-- ì—¬ëŸ¬ URL í•œë²ˆì— ì¶”ê°€ -->
                <div class="border-t border-slate-700 pt-6">
                    <h4 class="font-medium mb-3">ğŸ“ ì—¬ëŸ¬ URL í•œë²ˆì— ì¶”ê°€</h4>
                    <textarea id="product-urls-bulk" class="input-field w-full px-4 py-3 rounded-lg h-32" 
                              placeholder="URLì„ í•œ ì¤„ì— í•˜ë‚˜ì”© ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    <button onclick="addBulkUrls()" class="btn-primary px-6 py-3 rounded-lg font-medium mt-4 text-slate-900">
                        â• ì¼ê´„ ì¶”ê°€
                    </button>
                </div>
            </div>
            
            <!-- ìµœê·¼ ì¶”ê°€ëœ URL -->
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">ğŸ“‹ ìµœê·¼ ì¶”ê°€ëœ URL</h3>
                    <button onclick="loadRecentUrls()" class="px-4 py-2 rounded-lg text-sm bg-slate-700 hover:bg-slate-600">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
                <div id="recent-urls" class="space-y-2">
                    <p class="text-gray-500">ë¡œë”© ì¤‘...</p>
                </div>
            </div>
        </div>

        <!-- ===================== ë“±ë¡ëœ ì œí’ˆ ëª©ë¡ íƒ­ ===================== -->
        <div id="content-list" class="hidden space-y-6">
            <div class="card p-6">
                <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                    <h3 class="text-lg font-semibold">ğŸ“‹ ë“±ë¡ëœ ì œí’ˆ ëª©ë¡</h3>
                    <div class="flex gap-2 items-center">
                        <span id="product-count" class="text-sm text-gray-400 bg-slate-700 px-3 py-1 rounded-full">0ê°œ ì œí’ˆ</span>
                        <button onclick="loadProducts()" class="px-4 py-2 rounded-lg text-sm bg-slate-700 hover:bg-slate-600">
                            ğŸ”„ ìƒˆë¡œê³ ì¹¨
                        </button>
                    </div>
                </div>
                
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-left text-gray-400 text-sm border-b border-slate-700">
                                <th class="pb-3 pl-4">ID</th>
                                <th class="pb-3">SKU</th>
                                <th class="pb-3">ì œí’ˆëª…</th>
                                <th class="pb-3">ê°€ê²©</th>
                                <th class="pb-3">ìˆ˜ì§‘ì¼</th>
                                <th class="pb-3">ìƒíƒœ</th>
                                <th class="pb-3">ì‘ì—…</th>
                            </tr>
                        </thead>
                        <tbody id="product-list">
                            <!-- ë™ì ìœ¼ë¡œ ì¶”ê°€ë¨ -->
                        </tbody>
                    </table>
                </div>
                
                <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
                <div class="flex justify-center gap-2 mt-4">
                    <button onclick="prevPage()" class="px-4 py-2 rounded bg-slate-700 hover:bg-slate-600">â—€ ì´ì „</button>
                    <span id="page-info" class="px-4 py-2 text-gray-400">1 / 1</span>
                    <button onclick="nextPage()" class="px-4 py-2 rounded bg-slate-700 hover:bg-slate-600">ë‹¤ìŒ â–¶</button>
                </div>
            </div>
        </div>

        <!-- ===================== ë¡œê·¸ íƒ­ ===================== -->
        <div id="content-logs" class="hidden space-y-6">
            <div class="card p-6">
                <div class="flex flex-wrap justify-between items-center gap-4 mb-4">
                    <h3 class="text-lg font-semibold">ğŸ“œ ì‹¤ì‹œê°„ ë¡œê·¸</h3>
                    <div class="flex gap-2 items-center">
                        <button onclick="clearLogs()" class="px-4 py-2 rounded-lg text-sm bg-slate-700 hover:bg-slate-600">
                            ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°
                        </button>
                        <label class="flex items-center gap-2 text-sm text-gray-400 cursor-pointer">
                            <input type="checkbox" id="auto-scroll" checked class="checkbox-custom">
                            ìë™ ìŠ¤í¬ë¡¤
                        </label>
                    </div>
                </div>
                
                <div id="log-container" class="bg-slate-900 rounded-lg p-4 h-[500px] overflow-y-auto font-mono text-sm">
                    <p class="text-gray-500">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        let currentPage = 0;
        const pageSize = 50;
        let totalProducts = 0;
        let logMessages = [];
        
        // ==================== í˜ì´ì§€ ì œí•œ ì²´í¬ë°•ìŠ¤ ====================
        function togglePageLimit() {
            const checkbox = document.getElementById('limit-pages-checkbox');
            const input = document.getElementById('category-max-pages');
            const label = document.getElementById('pages-label');
            
            if (checkbox.checked) {
                input.disabled = false;
                label.textContent = 'í˜ì´ì§€';
                label.classList.remove('text-cyan-400');
                label.classList.add('text-gray-400');
            } else {
                input.disabled = true;
                label.textContent = 'ë¬´ì œí•œ';
                label.classList.remove('text-gray-400');
                label.classList.add('text-cyan-400');
            }
        }
        
        // ==================== íƒ­ ì „í™˜ ====================
        function showTab(tab) {
            ['category', 'product', 'list', 'logs'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('bg-cyan-500', 'text-white');
                document.getElementById(`tab-${t}`).classList.add('bg-slate-700', 'text-gray-300');
            });
            
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.remove('bg-slate-700', 'text-gray-300');
            document.getElementById(`tab-${tab}`).classList.add('bg-cyan-500', 'text-white');
            
            if (tab === 'list') loadProducts();
            if (tab === 'product') loadRecentUrls();
        }
        
        // ==================== ì¹´í…Œê³ ë¦¬ ì¶”ê°€ ====================
        async function addCategory() {
            const url = document.getElementById('category-url').value.trim();
            const name = document.getElementById('category-name').value.trim();
            const maxProducts = parseInt(document.getElementById('category-max').value) || 100;
            const limitPages = document.getElementById('limit-pages-checkbox').checked;
            const maxPages = parseInt(document.getElementById('category-max-pages').value) || 10;
            
            if (!url) {
                alert('ì¹´í…Œê³ ë¦¬ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                const response = await fetch('/api/url-queue/category', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        url, 
                        name, 
                        maxProducts, 
                        maxPages: limitPages ? maxPages : 0,
                        limitPages 
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('category-url').value = '';
                    document.getElementById('category-name').value = '';
                    loadUrlQueue();
                    addLogMessage({ type: 'success', message: `âœ… ì¹´í…Œê³ ë¦¬ ì¶”ê°€ë¨: ${name || url.substring(0, 50)}...`, timestamp: new Date().toISOString() });
                } else {
                    alert(data.error || 'ì¶”ê°€ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }
        
        // ==================== ì¹´í…Œê³ ë¦¬ ì‚­ì œ ====================
        async function deleteCategory(id) {
            if (!confirm('ì´ ì¹´í…Œê³ ë¦¬ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await fetch(`/api/url-queue/category/${id}`, { method: 'DELETE' });
                loadUrlQueue();
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ==================== âœ… URLë§Œ ìˆ˜ì§‘ (Phase 0ë§Œ) ====================
        async function processQueueUrlOnly() {
            if (!confirm('URLë§Œ ìˆ˜ì§‘í•©ë‹ˆë‹¤. (Phase 0ë§Œ ì‹¤í–‰)\n\nì œí’ˆ ìƒì„¸ ì •ë³´(ì œëª©, ê°€ê²©, ì´ë¯¸ì§€ ë“±)ëŠ” ìˆ˜ì§‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\nê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                addLogMessage({ type: 'info', message: 'ğŸ“¥ URL ìˆ˜ì§‘ ì‹œì‘ (Phase 0ë§Œ)', timestamp: new Date().toISOString() });
                
                const response = await fetch('/api/url-queue/process', { method: 'POST' });
                const data = await response.json();
                
                if (!data.success) {
                    alert(data.error || 'ì‹¤í–‰ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }
        
        // ==================== âœ… ì „ì²´ íŒŒì´í”„ë¼ì¸ (Phase 0â†’5) ====================
        async function processQueueFull() {
            if (!confirm('ğŸš€ ì „ì²´ íŒŒì´í”„ë¼ì¸ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.\n\nPhase 0: URL ìˆ˜ì§‘\nPhase 1: ì œí’ˆ ì •ë³´ ìŠ¤í¬ë˜í•‘\nPhase 2: ë°°ê²½ ì œê±°\nPhase 2.5: AI ì´ë¯¸ì§€ ê²€ì¦\nPhase 2.6: ì´ë¯¸ì§€ ì„ ë³„\nPhase 4: ìµœì¢… ì´ë¯¸ì§€ ìƒì„±\nPhase 5: Shopify ì—…ë¡œë“œ\n\nì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                addLogMessage({ type: 'info', message: 'ğŸš€ ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹œì‘ (Phase 0â†’1â†’2â†’3â†’4â†’5)', timestamp: new Date().toISOString() });
                showProgress();
                
                const response = await fetch('/api/url-queue/process-full', { method: 'POST' });
                const data = await response.json();
                
                if (!data.success) {
                    alert(data.error || 'ì‹¤í–‰ ì‹¤íŒ¨');
                    hideProgress();
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
                hideProgress();
            }
        }
        
        // ==================== ì¤‘ì§€ ====================
        async function stopQueue() {
            if (!confirm('ì •ë§ ì¤‘ì§€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const response = await fetch('/api/pipeline/stop', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    addLogMessage({ type: 'warning', message: 'ğŸ›‘ íŒŒì´í”„ë¼ì¸ ì¤‘ì§€ë¨', timestamp: new Date().toISOString() });
                    hideProgress();
                    loadUrlQueue();
                } else {
                    alert(data.error || 'ì¤‘ì§€ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }
        
        // ==================== ê°•ì œ ì¢…ë£Œ ====================
        async function forceKill() {
            if (!confirm('âš ï¸ ê²½ê³ : ê°•ì œ ì¢…ë£Œ!\n\nëª¨ë“  Phase í”„ë¡œì„¸ìŠ¤ì™€ Chromiumì„ ì¢…ë£Œí•©ë‹ˆë‹¤.\nì •ë§ ê°•ì œ ì¢…ë£Œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                addLogMessage({ type: 'warning', message: 'ğŸ”´ ê°•ì œ ì¢…ë£Œ ìš”ì²­ë¨...', timestamp: new Date().toISOString() });
                
                const response = await fetch('/api/force-kill', { method: 'POST' });
                const data = await response.json();
                
                if (data.success) {
                    addLogMessage({ type: 'success', message: 'âœ… ê°•ì œ ì¢…ë£Œ ì™„ë£Œ!', timestamp: new Date().toISOString() });
                    hideProgress();
                    loadUrlQueue();
                } else {
                    alert('âŒ ê°•ì œ ì¢…ë£Œ ì‹¤íŒ¨: ' + (data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
                }
            } catch (error) {
                alert('âŒ ì˜¤ë¥˜: ' + error.message);
            }
        }
        
        // ==================== ì™„ë£Œ í•­ëª© ì‚­ì œ ====================
        async function clearCompleted() {
            try {
                const response = await fetch('/api/url-queue');
                const queue = await response.json();
                
                let deleted = 0;
                for (const cat of (queue.categories || [])) {
                    if (cat.status === 'completed') {
                        await fetch(`/api/url-queue/category/${cat.id}`, { method: 'DELETE' });
                        deleted++;
                    }
                }
                
                if (deleted > 0) {
                    addLogMessage({ type: 'info', message: `ğŸ—‘ï¸ ${deleted}ê°œ ì™„ë£Œ í•­ëª© ì‚­ì œë¨`, timestamp: new Date().toISOString() });
                }
                
                loadUrlQueue();
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ==================== ê°œë³„ URL ì¶”ê°€ ====================
        async function addProductUrl() {
            const url = document.getElementById('product-url').value.trim();
            
            if (!url) {
                alert('ì œí’ˆ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            try {
                const response = await fetch('/api/url-queue/product', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('product-url').value = '';
                    addLogMessage({ type: 'success', message: `âœ… URL ì¶”ê°€ë¨ (SKU: ${data.sku})`, timestamp: new Date().toISOString() });
                    loadRecentUrls();
                } else {
                    alert(data.error || 'ì¶”ê°€ ì‹¤íŒ¨');
                }
            } catch (error) {
                alert('ì˜¤ë¥˜: ' + error.message);
            }
        }
        
        // ==================== ì¼ê´„ URL ì¶”ê°€ ====================
        async function addBulkUrls() {
            const text = document.getElementById('product-urls-bulk').value.trim();
            const urls = text.split('\n').filter(u => u.trim());
            
            if (urls.length === 0) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            let success = 0, failed = 0, duplicates = 0;
            
            for (const url of urls) {
                try {
                    const response = await fetch('/api/url-queue/product', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ url: url.trim() })
                    });
                    
                    const data = await response.json();
                    if (data.success) success++;
                    else if (data.error?.includes('ì´ë¯¸ ë“±ë¡')) duplicates++;
                    else failed++;
                } catch {
                    failed++;
                }
            }
            
            alert(`ì¶”ê°€ ì™„ë£Œ:\nâœ… ì„±ê³µ: ${success}ê°œ\nâš ï¸ ì¤‘ë³µ: ${duplicates}ê°œ\nâŒ ì‹¤íŒ¨: ${failed}ê°œ`);
            document.getElementById('product-urls-bulk').value = '';
            loadRecentUrls();
        }
        
        // ==================== URL í ë¡œë“œ ====================
        async function loadUrlQueue() {
            try {
                const response = await fetch('/api/url-queue');
                const queue = await response.json();
                
                const container = document.getElementById('category-queue');
                
                if (!queue.categories || queue.categories.length === 0) {
                    container.innerHTML = '<p class="text-gray-500 text-center py-8">ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì¶”ê°€í•´ì£¼ì„¸ìš”.</p>';
                    return;
                }
                
                container.innerHTML = queue.categories.map((cat, index) => {
                    const pagesText = cat.maxPages === 0 ? 'ë¬´ì œí•œ' : `${cat.maxPages}í˜ì´ì§€`;
                    const pagesClass = cat.maxPages === 0 ? 'text-cyan-400' : 'text-yellow-400';
                    
                    return `
                    <div class="flex items-center gap-4 p-4 bg-slate-800 rounded-lg hover:bg-slate-750 transition-colors">
                        <span class="text-gray-500 cursor-move">â˜°</span>
                        <span class="w-8 h-8 flex items-center justify-center bg-slate-700 rounded-full text-sm font-medium">${index + 1}</span>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium truncate">${cat.name || 'ì´ë¦„ ì—†ìŒ'}</p>
                            <p class="text-sm text-gray-400 truncate">${cat.url.substring(0, 60)}...</p>
                        </div>
                        <span class="text-sm text-cyan-400 whitespace-nowrap">ìµœëŒ€ ${cat.maxProducts}ê°œ</span>
                        <span class="text-sm ${pagesClass} whitespace-nowrap">${pagesText}</span>
                        <span class="status-${cat.status} text-sm whitespace-nowrap">${getStatusText(cat.status)}</span>
                        <button onclick="deleteCategory('${cat.id}')" class="text-red-400 hover:text-red-300 px-2 hover:bg-red-900/30 rounded transition-colors">ğŸ—‘ï¸</button>
                    </div>
                `;
                }).join('');
                
            } catch (error) {
                console.error('URL í ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        function getStatusText(status) {
            const texts = {
                'pending': 'â³ ëŒ€ê¸°ì¤‘',
                'processing': 'ğŸ”„ ì²˜ë¦¬ì¤‘',
                'completed': 'âœ… ì™„ë£Œ',
                'error': 'âŒ ì˜¤ë¥˜'
            };
            return texts[status] || status;
        }
        
        // ==================== ìµœê·¼ URL ë¡œë“œ ====================
        async function loadRecentUrls() {
            try {
                const response = await fetch('/api/oliveyoung/products?limit=10');
                const data = await response.json();
                
                const container = document.getElementById('recent-urls');
                
                if (!data.list || data.list.length === 0) {
                    container.innerHTML = '<p class="text-gray-500">ë“±ë¡ëœ URLì´ ì—†ìŠµë‹ˆë‹¤</p>';
                    return;
                }
                
                container.innerHTML = data.list.map(p => `
                    <div class="flex items-center gap-4 p-3 bg-slate-800 rounded-lg">
                        <div class="flex-1 min-w-0">
                            <p class="text-sm font-medium truncate">${p.title_kr || p.sku || 'ì œëª© ì—†ìŒ'}</p>
                            <p class="text-xs text-gray-500">SKU: ${p.sku || '-'}</p>
                        </div>
                        <span class="text-xs text-gray-400 whitespace-nowrap">${p.collected_at ? new Date(p.collected_at).toLocaleDateString('ko-KR') : '-'}</span>
                    </div>
                `).join('');
                
            } catch (error) {
                console.error('ìµœê·¼ URL ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ==================== ì œí’ˆ ëª©ë¡ ë¡œë“œ ====================
        async function loadProducts() {
            try {
                const response = await fetch(`/api/oliveyoung/products?limit=${pageSize}&offset=${currentPage * pageSize}`);
                const data = await response.json();
                
                totalProducts = data.total || data.list?.length || 0;
                document.getElementById('product-count').textContent = `${totalProducts}ê°œ ì œí’ˆ`;
                
                const totalPages = Math.ceil(totalProducts / pageSize) || 1;
                document.getElementById('page-info').textContent = `${currentPage + 1} / ${totalPages}`;
                
                const tbody = document.getElementById('product-list');
                
                if (!data.list || data.list.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" class="text-center py-8 text-gray-500">ë“±ë¡ëœ ì œí’ˆì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                    return;
                }
                
                tbody.innerHTML = data.list.map(p => `
                    <tr class="border-b border-slate-700 hover:bg-slate-800 transition-colors">
                        <td class="py-3 pl-4">${p.Id}</td>
                        <td class="py-3 text-sm text-cyan-400 font-mono">${p.sku || '-'}</td>
                        <td class="py-3">
                            <span title="${p.title_kr || ''}">${(p.title_kr || '').substring(0, 25)}${(p.title_kr || '').length > 25 ? '...' : ''}</span>
                        </td>
                        <td class="py-3">${p.price_current ? 'â‚©' + p.price_current.toLocaleString() : '-'}</td>
                        <td class="py-3 text-sm text-gray-400">${p.collected_at ? new Date(p.collected_at).toLocaleDateString('ko-KR') : '-'}</td>
                        <td class="py-3">
                            ${p.product_images ? '<span class="text-green-400">âœ… ì™„ë£Œ</span>' : '<span class="text-yellow-400">â³ ëŒ€ê¸°</span>'}
                        </td>
                        <td class="py-3">
                            <button onclick="deleteProduct(${p.Id})" class="text-red-400 hover:text-red-300 text-sm hover:underline">ì‚­ì œ</button>
                        </td>
                    </tr>
                `).join('');
                
            } catch (error) {
                console.error('ì œí’ˆ ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }
        
        // ==================== ì œí’ˆ ì‚­ì œ ====================
        async function deleteProduct(id) {
            if (!confirm('ì´ ì œí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                await fetch(`/api/oliveyoung/products/${id}`, { method: 'DELETE' });
                loadProducts();
            } catch (error) {
                alert('ì‚­ì œ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ==================== í˜ì´ì§€ë„¤ì´ì…˜ ====================
        function prevPage() {
            if (currentPage > 0) {
                currentPage--;
                loadProducts();
            }
        }
        
        function nextPage() {
            const totalPages = Math.ceil(totalProducts / pageSize);
            if (currentPage < totalPages - 1) {
                currentPage++;
                loadProducts();
            }
        }
        
        // ==================== ì§„í–‰ ìƒí™© í‘œì‹œ ====================
        function showProgress() {
            document.getElementById('progress-section').classList.remove('hidden');
        }
        
        function hideProgress() {
            document.getElementById('progress-section').classList.add('hidden');
        }
        
        function updateProgress(progress) {
            const percent = progress.total > 0 ? Math.round((progress.current / progress.total) * 100) : 0;
            
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('progress-current').textContent = `${progress.current}ê°œ ì²˜ë¦¬ë¨`;
            document.getElementById('progress-percent').textContent = `${percent}%`;
            document.getElementById('progress-phase').textContent = progress.phase || '';
        }
        
        // ==================== ë¡œê·¸ ====================
        function addLogMessage(log) {
            const container = document.getElementById('log-container');
            
            if (logMessages.length === 0) {
                container.innerHTML = '';
            }
            
            logMessages.push(log);
            
            if (logMessages.length > 500) {
                logMessages.shift();
                if (container.firstChild) container.removeChild(container.firstChild);
            }
            
            const logDiv = document.createElement('div');
            logDiv.className = 'flex gap-2 py-1 border-b border-slate-800';
            
            const time = log.timeFormatted || new Date(log.timestamp).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit', second: '2-digit'});
            
            logDiv.innerHTML = `
                <span class="log-time">[${time}]</span>
                <span class="log-${log.type || 'info'}">${log.message}</span>
            `;
            
            container.appendChild(logDiv);
            
            if (document.getElementById('auto-scroll').checked) {
                container.scrollTop = container.scrollHeight;
            }
        }
        
        function clearLogs() {
            logMessages = [];
            document.getElementById('log-container').innerHTML = '<p class="text-gray-500">ë¡œê·¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤...</p>';
        }
        
        // ==================== Socket.io ì´ë²¤íŠ¸ ====================
        socket.on('state', (state) => {
            const badge = document.getElementById('status-badge');
            const text = document.getElementById('status-text');
            
            badge.className = 'status-badge ' + (state.status || 'idle');
            
            const statusTexts = {
                idle: 'ëŒ€ê¸°ì¤‘',
                running: 'ì‹¤í–‰ì¤‘',
                paused: 'ì¼ì‹œì •ì§€',
                error: 'ì˜¤ë¥˜'
            };
            text.textContent = state.currentPhase || statusTexts[state.status] || 'ëŒ€ê¸°ì¤‘';
            
            if (state.status === 'running') {
                showProgress();
            } else if (state.status === 'idle') {
                hideProgress();
            }
        });
        
        socket.on('urlQueue', () => {
            loadUrlQueue();
        });
        
        socket.on('log', (log) => {
            addLogMessage(log);
        });
        
        socket.on('logs', (existingLogs) => {
            existingLogs.forEach(log => addLogMessage(log));
        });
        
        socket.on('progress', (progress) => {
            updateProgress(progress);
        });
        
        // ==================== ì´ˆê¸° ë¡œë“œ ====================
        loadUrlQueue();
        loadRecentUrls();
    </script>
</body>
</html>